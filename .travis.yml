language: go
go:
  - "1.11.x"
sudo: false
env:
  global:
    - "GO111MODULE=on"
go_import_path: "go.linecorp.com/centraldogma"
install:
  - go get -v go.linecorp.com/centraldogma
  - go get -v go.linecorp.com/centraldogma/internal/app/dogma
script:
  - go test -v -race -coverprofile=coverage.1.txt -covermode=atomic go.linecorp.com/centraldogma
  - go test -v -race -coverprofile=coverage.2.txt -covermode=atomic go.linecorp.com/centraldogma/internal/app/dogma
  - cat coverage.*.txt > coverage.txt
after_success:
  - bash <(curl -s https://codecov.io/bash)
notifications:
  email: false
cache:
  directories:
    - "$GOPATH/pkg/mod/cache"
